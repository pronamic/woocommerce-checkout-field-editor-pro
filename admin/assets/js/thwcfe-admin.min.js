function thwcfeAddNewValidatorRow(elm,prefix){thwcfe_settings_advanced.addNewValidatorRow(elm,prefix)}function thwcfeRemoveValidatorRow(elm,prefix){thwcfe_settings_advanced.removeValidatorRow(elm,prefix)}function thwcfeImportSettings(){thwcfe_settings_advanced.import_settings()}function thwcfeSetupEnhancedMultiSelectWithValue(elm){thwcfe_base.setupEnhancedMultiSelectWithValue(elm)}function thwcfeSetupSortableTable(parent,elm,left){thwcfe_base.setupSortableTable(parent,elm,left)}function thwcfeSetupPopupTabs(parent,elm,left){thwcfe_base.setupPopupTabs(parent,elm,left)}function thwcfeOpenFormTab(elm,tab_id,form_type){thwcfe_base.openFormTab(elm,tab_id,form_type)}function thwcfeCloseModal(elm){thwcfe_base.form_wizard_close(elm)}function thwcfeWizardNext(elm){thwcfe_base.form_wizard_next(elm)}function thwcfeWizardPrevious(elm){thwcfe_base.form_wizard_previous(elm)}function thwcfeRuleOperandTypeChangeListner(elm){thwcfe_conditions.ruleOperandTypeChangeListner(elm)}function thwcfeRuleOperatorChangeListner(elm){thwcfe_conditions.ruleOperatorChangeListner(elm)}function thwcfeRuleOperatorChangeListnerAjax(elm){thwcfe_conditions.ruleOperatorChangeListnerAjax(elm)}function thwcfeAddNewConditionRow(elm,op){thwcfe_conditions.addNewRuleRow(elm,op)}function thwcfeRemoveRuleRow(elm){thwcfe_conditions.removeRuleRow(elm)}function thwcfeAddNewConditionRowAjax(elm,op){thwcfe_conditions.addNewRuleRowAjax(elm,op)}function thwcfeRemoveRuleRowAjax(elm){thwcfe_conditions.removeRuleRowAjax(elm)}function thwcfeOpenNewFieldForm(sectionName){thwcfe_settings_field.openNewFieldForm(sectionName)}function thwcfeOpenEditFieldForm(elm,rowId){thwcfe_settings_field.openEditFieldForm(elm,rowId)}function thwcfeOpenCopyFieldForm(elm,rowId){thwcfe_settings_field.openCopyFieldForm(elm,rowId)}function thwcfeFieldTypeChangeListner(elm){thwcfe_settings_field.fieldTypeChangeListner(elm)}function thwcfeAddNewOptionRow(elm){thwcfe_settings_field.addNewOptionRow(elm)}function thwcfeRemoveOptionRow(elm){thwcfe_settings_field.removeOptionRow(elm)}function thwcfePriceTypeChangeListener(elm){thwcfe_settings_field.priceTypeChangeListener(elm)}function thwcfeSaveField(elm){thwcfe_settings_field.save_field(elm)}function thwcfeRepeatOperatorChangeListner(elm){thwcfe_repeat_rules.repeatOperatorChangeListner(elm)}function thwcfeRepeatOperandTypeChangeListner(elm){thwcfe_repeat_rules.repeatOperandTypeChangeListner(elm)}function thwcfeOpenNewSectionForm(){thwcfe_settings_section.openNewSectionForm()}function thwcfeOpenEditSectionForm(section){thwcfe_settings_section.openEditSectionForm(section)}function thwcfeOpenCopySectionForm(section){thwcfe_settings_section.openCopySectionForm(section)}function thwcfeDisplayPositionChangeListner(elm){thwcfe_settings_section.DisplayPositionChangeListner(elm)}function thwcfeSaveSection(elm){thwcfe_settings_section.save_section(elm)}function thwcfeRemoveSection(elm){thwcfe_settings_section.remove_section(elm)}function thwcfeSelectAllCheckoutFields(elm){thwcfe_settings.selectAllFields(elm)}function thwcfeRemoveSelectedFields(){thwcfe_settings.removeSelectedFields()}function thwcfeEnableSelectedFields(){thwcfe_settings.enableDisableSelectedFields(1)}function thwcfeDisableSelectedFields(){thwcfe_settings.enableDisableSelectedFields(0)}function thwcfeBulkActionListner(elm){thwcfe_settings.bulkActionListner(elm)}function thwcfeApplyBulkAction(elm,event){thwcfe_settings.applyBulkAction(elm,event)}function thwcfeCheckoutFieldSelected(elm){thwcfe_settings.checkoutFieldSelected(elm)}function thwcfeRestoreDefaultFields(elm,event){thwcfe_settings.restoreDefaultFields(elm,event)}function thwcfewidgetPopUp(){thwcfe_settings.thwcfewidgetPopUp()}function thwcfewidgetClose(){thwcfe_settings.thwcfewidgetClose()}var thwcfe_settings_advanced=function($,window,document){function import_settings(){}$(function(){var advanced_settings_form=$("#advanced_settings_form");advanced_settings_form[0]&&thwcfe_base.setupEnhancedMultiSelectWithValue(advanced_settings_form)});var VALIDATOR_ROW_HTML="<tr>";VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="text" name="i_validator_name[]" placeholder="Validator Name" style="width:180px;"/></td>',VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="text" name="i_validator_label[]" placeholder="Validator Label" style="width:180px;"/></td>',VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="text" name="i_validator_pattern[]" placeholder="Validator Pattern" style="width:180px;"/></td>',VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="text" name="i_validator_message[]" placeholder="Validator Message" style="width:180px;"/></td>',VALIDATOR_ROW_HTML+='<td class="action-cell">',VALIDATOR_ROW_HTML+='<a href="javascript:void(0)" onclick="thwcfeAddNewValidatorRow(this, 0)" class="dashicons dashicons-plus" title="Add new validator"></a></td>',VALIDATOR_ROW_HTML+='<td class="action-cell">',VALIDATOR_ROW_HTML+='<a href="javascript:void(0)" onclick="thwcfeRemoveValidatorRow(this, 0)" class="dashicons dashicons-no-alt" title="Remove validator"></a></td>',VALIDATOR_ROW_HTML+="</tr>";var CNF_VALIDATOR_ROW_HTML="<tr>";return CNF_VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="text" name="i_cnf_validator_name[]" placeholder="Validator Name" style="width:180px;"/></td>',CNF_VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="text" name="i_cnf_validator_label[]" placeholder="Validator Label" style="width:180px;"/></td>',CNF_VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="text" name="i_cnf_validator_pattern[]" placeholder="Field Name" style="width:180px;"/></td>',CNF_VALIDATOR_ROW_HTML+='<td style="width:190px;"><input type="text" name="i_cnf_validator_message[]" placeholder="Validator Message" style="width:180px;"/></td>',CNF_VALIDATOR_ROW_HTML+='<td class="action-cell">',CNF_VALIDATOR_ROW_HTML+='<a href="javascript:void(0)" onclick="thwcfeAddNewValidatorRow(this, 1)" class="dashicons dashicons-plus" title="Add new validator"></a></td>',CNF_VALIDATOR_ROW_HTML+='<td class="action-cell">',CNF_VALIDATOR_ROW_HTML+='<a href="javascript:void(0)" onclick="thwcfeRemoveValidatorRow(this, 1)" class="dashicons dashicons-no-alt" title="Remove validator"></a></td>',CNF_VALIDATOR_ROW_HTML+="</tr>",addNewValidatorRow=function(elm,prefix){var ptable=$(elm).closest("table"),rowsSize=ptable.find("tbody tr").size(),ROW_HTML=VALIDATOR_ROW_HTML;1==prefix&&(ROW_HTML=CNF_VALIDATOR_ROW_HTML),rowsSize>0?ptable.find("tbody tr:last").after(ROW_HTML):ptable.find("tbody").append(ROW_HTML)},removeValidatorRow=function(elm,prefix){var ptable=$(elm).closest("table");$(elm).closest("tr").remove();var rowsSize=ptable.find("tbody tr").size(),ROW_HTML=VALIDATOR_ROW_HTML;1==prefix&&(ROW_HTML=CNF_VALIDATOR_ROW_HTML),0==rowsSize&&ptable.find("tbody").append(ROW_HTML)},{addNewValidatorRow:addNewValidatorRow,removeValidatorRow:removeValidatorRow,import_settings:import_settings}}(window.jQuery,window,document),thwcfe_base=function($,window,document){"use strict";function escapeHTML(html){var fn=function(tag){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;"}[tag]||tag};return html.replace(/[&<>"]/g,fn)}function decodeHtml(str){if(str&&"string"==typeof str){var map={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return str.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(m){return map[m]})}return str}function isHtmlIdValid(id){var re=/^[a-z\_]+[a-z0-9\_]*$/;return 0==wcfe_var.sanitize_names&&(re=/^[a-zA-Z\_]+[a-zA-Z0-9\_]*$/),re.test(id.trim())}function isValidHexColor(value){return!!preg_match("/^#[a-f0-9]{6}$/i",value)}function is_option_field(type){var result=!1;return"select"!=type&&"multiselect"!=type&&"radio"!=type&&"checkboxgroup"!=type||(result=!0),result}function setup_tiptip_tooltips(){var tiptip_args={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200};$(".tips").tipTip(tiptip_args)}function setup_enhanced_multi_select(parent){parent.find("select.thwcfe-enhanced-multi-select").each(function(){$(this).hasClass("enhanced")||$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder")}).addClass("enhanced")})}function setup_enhanced_multi_select_with_value(parent){parent.find("select.thwcfe-enhanced-multi-select").each(function(){if(!$(this).hasClass("enhanced")){$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder")}).addClass("enhanced");var value=$(this).data("value");value=value.split(","),$(this).val(value),$(this).trigger("change")}})}function setup_product_dropdown(parent,set_dv){parent.find("select.thwcfe-product-select").each(function(){if(!$(this).hasClass("enhanced")){set_dv&&prepare_selected_options($(this));$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder"),escapeMarkup:function(text){return text},ajax:{type:"POST",url:wcfe_var.ajax_url,dataType:"json",data:function(params){return{action:"thwcfe_load_products",term:params.term||"",page:params.page||1}},processResults:function(result,params){return result.data},cache:!0}}).addClass("enhanced")}})}function setup_product_type_dropdown(parent,set_dv){parent.find("select.thwcfe-product-type-select").each(function(){if(!$(this).hasClass("enhanced")){set_dv&&prepare_selected_options_product_type($(this));$(this).selectWoo({allowClear:!0,placeholder:$(this).data("placeholder"),escapeMarkup:function(text){return text},ajax:{type:"POST",url:wcfe_var.ajax_url,dataType:"json",data:function(params){return{action:"thwcfe_load_product_type",term:params.term||"",page:params.page||1}},processResults:function(result,params){return result.data},cache:!0}}).addClass("enhanced")}})}function prepare_selected_options(elm){var value=elm.siblings("input[name=i_rule_operand_hidden]").val();if(value){var data={action:"thwcfe_load_products",value:value};$.ajax({type:"POST",url:wcfe_var.ajax_url,data:data,success:function(result){$.each(result.data.results,function(key,value){var newOption=new Option(value.text,value.id,!0,!0);elm.append(newOption)})}}),elm.trigger("change")}}function prepare_selected_options_product_type(elm){var value=elm.siblings("input[name=i_rule_operand_hidden]").val();if(value){var data={action:"thwcfe_load_product_type",value:value};$.ajax({type:"POST",url:wcfe_var.ajax_url,data:data,success:function(result){$.each(result.data.results,function(key,value){var newOption=new Option(value.text,value.id,!0,!0);elm.append(newOption)})}}),elm.trigger("change")}}function setup_color_picker(form){form.find(".thpladmin-colorpick").iris({change:function(event,ui){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:ui.color.toString()})},hide:!0,border:!0}).click(function(){$(".iris-picker").hide(),$(this).closest("td").find(".iris-picker").show()}),$("body").click(function(){$(".iris-picker").hide()}),$(".thpladmin-colorpick").click(function(event){event.stopPropagation()})}function setup_color_pick_preview(form){form.find(".thpladmin-colorpick").each(function(){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:this.value})})}function setup_popup_tabs(form){$(".thpladmin-tabs-menu a").click(function(event){event.preventDefault(),$(this).parent().addClass("current"),$(this).parent().siblings().removeClass("current");var tab=$(this).attr("href");$(".thpladmin-tab-content").not(tab).css("display","none"),$(tab).fadeIn()})}function open_form_tab(elm,tab_id,form_type){var tabs_container=$(elm).closest("#thwcfe-tabs-container_"+form_type);$(elm).parent().addClass("current"),$(elm).parent().siblings().removeClass("current");var tab=$("#"+tab_id+"_"+form_type);tabs_container.find(".thpladmin-tab-content").not(tab).css("display","none"),$(tab).fadeIn()}function prepare_field_order_indexes(elm){$(elm+" tbody tr").each(function(index,el){$("input.f_order",el).val(parseInt($(el).index(elm+" tbody tr")))})}function setup_sortable_table(parent,elm,left){parent.find(elm+" tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:".sort",scrollSensitivity:40,helper:function(e,ui){return ui.children().each(function(){$(this).width($(this).width())}),ui.css("left",left),ui}}),$(elm+" tbody").on("sortstart",function(event,ui){ui.item.css("background-color","#f6f6f6")}),$(elm+" tbody").on("sortstop",function(event,ui){ui.item.removeAttr("style"),prepare_field_order_indexes(elm)})}function get_property_field_value(form,type,name){var value="";switch(type){case"select":value=form.find("select[name=i_"+name+"]").val(),value=null==value?"":value;break;case"checkbox":value=form.find("input[name=i_"+name+"]").prop("checked"),value=value?1:0;break;case"textarea":value=form.find("textarea[name=i_"+name+"]").val(),value=null==value?"":value;break;default:value=form.find("input[name=i_"+name+"]").val(),value=null==value?"":value}return value}function set_property_field_value(form,type,name,value,multiple){switch(type){case"select":1==multiple&&"string"==typeof value&&(value=value.split(","),name+="[]"),form.find('select[name="i_'+name+'"]').val(value);break;case"checkbox":value=1==value||"yes"==value,form.find("input[name=i_"+name+"]").prop("checked",value);break;case"textarea":value=value?decodeHtml(value):value,form.find("textarea[name=i_"+name+"]").val(value);break;case"colorpicker":var bg_color=value?{backgroundColor:value}:{};form.find("input[name=i_"+name+"]").val(value),form.find("."+name+"_preview").css(bg_color);break;default:value=value?decodeHtml(value):value,form.find("input[name=i_"+name+"]").val(value)}}function setup_form_wizard(){$(".pp_nav_links > li").click(function(){var index=$(this).data("index");open_tab($(this).closest(".thpladmin-modal-mask"),$(this),index),active_tab=index})}function get_popup(elm){return $(elm).closest(".thpladmin-modal-mask")}function get_active_tab(popup){return popup.find("ul.pp_nav_links").find("li.active")}function get_next_tab_index(elm){var popup=get_popup(elm),active=get_active_tab(popup),link=active.nextAll("li").not(".disabled").first();return link.length?link.data("index"):active_tab}function get_prev_tab_index(elm){var popup=get_popup(elm),active=get_active_tab(popup),link=active.prevAll("li").not(".disabled").first();return link.length?link.data("index"):active_tab}function form_wizard_open(popup){active_tab=0,popup.find("ul.pp_nav_links li").first().click(),popup.css("display","block")}function form_wizard_close(elm){get_popup(elm).css("display","none"),active_tab=0}function form_wizard_next(elm){active_tab=get_next_tab_index(elm),move_to(elm,active_tab)}function form_wizard_previous(elm){active_tab=get_prev_tab_index(elm),move_to(elm,active_tab)}function form_wizard_start(elm){active_tab=0,move_to(elm,active_tab)}function move_to(elm,index){var popup=get_popup(elm);open_tab(popup,popup.find('*[data-index="'+index+'"]'),index)}function open_tab(popup,link,index){var panel=popup.find(".data_panel_"+index);close_all_data_panel(popup),link.addClass("active"),panel.css("display","block"),enable_disable_btns(popup,link)}function close_all_data_panel(popup){popup.find(".pp_nav_links > li").removeClass("active"),popup.find(".data-panel").css("display","none")}function enable_disable_tab(popup,index,disable){var link=popup.find('*[data-index="'+index+'"]'),panel=popup.find(".data_panel_"+index);disable?(link.addClass("disabled"),panel.find(":input").attr("disabled",!0)):(link.removeClass("disabled"),panel.find(":input").attr("disabled",!1))}function form_wizard_enable_tab(popup,index){enable_disable_tab(popup,index,0)}function form_wizard_disable_tab(popup,index){enable_disable_tab(popup,index,1)}function form_wizard_enable_all_tabs(popup){popup.find(".pp_nav_links > li").removeClass("disabled")}function enable_disable_btns(popup,link){var nextBtn=popup.find(".next-btn"),prevBtn=popup.find(".prev-btn");link.hasClass("first")?(nextBtn.prop("disabled",!1),prevBtn.prop("disabled",!0)):link.hasClass("last")?(nextBtn.prop("disabled",!0),prevBtn.prop("disabled",!1)):(nextBtn.prop("disabled",!1),prevBtn.prop("disabled",!1))}function block_enter_key_submission(popup){popup.find("input").off("keypress").on("keypress",function(e){return 13!==e.which})}var active_tab=0;return{escapeHTML:escapeHTML,decodeHtml:decodeHtml,isHtmlIdValid:isHtmlIdValid,isValidHexColor:isValidHexColor,is_option_field:is_option_field,setup_tiptip_tooltips:setup_tiptip_tooltips,setupEnhancedMultiSelect:setup_enhanced_multi_select,setupEnhancedMultiSelectWithValue:setup_enhanced_multi_select_with_value,setupProductDropdown:setup_product_dropdown,setupProductTypeDropdown:setup_product_type_dropdown,prepare_selected_options:prepare_selected_options,setupColorPicker:setup_color_picker,setup_color_pick_preview:setup_color_pick_preview,setupSortableTable:setup_sortable_table,setupPopupTabs:setup_popup_tabs,openFormTab:open_form_tab,get_property_field_value:get_property_field_value,set_property_field_value:set_property_field_value,setup_form_wizard:setup_form_wizard,form_wizard_open:form_wizard_open,form_wizard_close:form_wizard_close,form_wizard_next:form_wizard_next,form_wizard_previous:form_wizard_previous,form_wizard_start:form_wizard_start,form_wizard_enable_tab:form_wizard_enable_tab,form_wizard_disable_tab:form_wizard_disable_tab,form_wizard_enable_all_tabs:form_wizard_enable_all_tabs,block_enter_key_submission:block_enter_key_submission}}(window.jQuery,window,document),thwcfe_conditions=function($,window,document){"use strict";function prepareRuleOperatorSet(value){var html='<select name="i_rule_operator" value="'+value+'" onchange="thwcfeRuleOperatorChangeListner(this)">';html+='<option value="">Select an option...</option>';for(var index in RULE_OPERATOR_SET){html+='<option value="'+index+'" '+(index===value?"selected":"")+">"+RULE_OPERATOR_SET[index]+"</option>"}return html+="</select>"}function prepareRuleOperandTypeSet(value){var html='<select name="i_rule_operand_type" onchange="thwcfeRuleOperandTypeChangeListner(this)" value="'+value+'">';html+='<option value="">Select an option...</option>';for(var index in RULE_OPERAND_TYPE_SET){html+='<option value="'+index+'" '+(index===value?"selected":"")+">"+RULE_OPERAND_TYPE_SET[index]+"</option>"}return html+="</select>"}function prepareRuleOperandSet(operand_type,operand,operator){var html='<input type="hidden" name="i_rule_operand_hidden" value="'+operand+'"/>';return html+="product"===operand_type?$("#thwcfe_product_select").html():"category"===operand_type?$("#thwcfe_product_cat_select").html():"tag"===operand_type?$("#thwcfe_product_tag_select").html():"product_type"===operand_type?$("#thwcfe_product_type_select").html():"shipping_class"===operand_type?'<input type="text" name="i_rule_operand" value="'+operand+'" placeholder="Enter slug of shipping class" value="" style="width: 98%;"/>':"user_role_eq"===operator||"user_role_ne"===operator?$("#thwcfe_user_role_select").html():'<input type="text" name="i_rule_operand" value="'+operand+'"/>'}function is_condition_with_no_operand_type(operator){return!!(operator&&$.inArray(operator,RULE_OPERATOR_SET_NO_TYPE)>-1)}function is_valid_condition(condition){return!(!condition.operand_type||!condition.operator)||!(!is_condition_with_no_operand_type(condition.operator)||!condition.operand)}function rule_operand_type_change_listner(elm){var operand_type=$(elm).val(),condition_row=$(elm).closest("tr.thwcfe_condition"),target=condition_row.find("td.thpladmin_rule_operand"),value=condition_row.find("input[name='i_rule_operand_hidden']").val();"product"===operand_type?target.html($("#thwcfe_product_select").html()):"category"===operand_type?target.html($("#thwcfe_product_cat_select").html()):"tag"===operand_type?target.html($("#thwcfe_product_tag_select").html()):"product_type"===operand_type?target.html($("#thwcfe_product_type_select").html()):"shipping_class"===operand_type?(value=value||"",target.html('<input type="text" name="i_rule_operand" value="'+value+'" placeholder="Enter slug of shipping class" value="" style="width: 98%;"/>')):(value=value||"",target.html('<input type="text" name="i_rule_operand" style="width:200px;" value="'+value+'"/>')),thwcfe_base.setupEnhancedMultiSelect(condition_row),thwcfe_base.setupProductDropdown(condition_row,!1),thwcfe_base.setupProductTypeDropdown(condition_row,!1)}function add_new_rule_row(elm,op){var condition_row=$(elm).closest("tr"),condition={};if(condition.operand_type=condition_row.find("select[name=i_rule_operand_type]").val(),condition.operator=condition_row.find("select[name=i_rule_operator]").val(),condition.operand=condition_row.find("select[name=i_rule_operand]").val(),is_condition_with_no_operand_type(condition.operator)&&(condition.operand_type="","user_role_eq"!=condition.operator&&"user_role_ne"!=condition.operator&&(condition.operand=condition_row.find("input[name=i_rule_operand]").val())),!is_valid_condition(condition))return void alert("Please provide a valid condition.");if(1==op){var conditionSetTable=$(elm).closest(".thwcfe_condition_set");conditionSetTable.find("tbody tr.thwcfe_condition").size()>0?($(elm).closest("td").html(OP_AND_HTML),conditionSetTable.find("tbody tr.thwcfe_condition:last").after(CONDITION_HTML)):conditionSetTable.find("tbody").append(CONDITION_HTML)}else if(2==op){var ruleTable=$(elm).closest(".thwcfe_rule"),ruleSize=ruleTable.find("tbody tr.thwcfe_condition_set_row").size();ruleSize>0?ruleTable.find("tbody tr.thwcfe_condition_set_row:last").after(CONDITION_SET_HTML_WITH_OR):ruleTable.find("tbody").append(CONDITION_SET_HTML)}}function remove_rule_row(elm){var ctable=$(elm).closest("table.thwcfe_condition_set"),rtable=$(elm).closest("table.thwcfe_rule");$(elm).closest("tr.thwcfe_condition").remove();var cSize=ctable.find("tbody tr.thwcfe_condition").size();0==cSize?ctable.closest("tr.thwcfe_condition_set_row").remove():ctable.find("tbody tr.thwcfe_condition:last").find("td.actions").html(OP_HTML);var rSize=rtable.find("tbody tr.thwcfe_condition_set_row").size();0==cSize&&0==rSize&&rtable.find("tbody").append(CONDITION_SET_HTML)}function get_conditional_rules(elm,ajaxFlag){var rulesTable;rulesTable=ajaxFlag?$(elm).find(".thwcfe_conditional_rules_ajax > tbody"):$(elm).find(".thwcfe_conditional_rules > tbody");var conditionalRules=[],ruleSet=[],rule=[],conditions=[],condition={};rulesTable.find("tr.thwcfe_rule_set_row").each(function(){ruleSet=[],$(this).find("table.thwcfe_rule_set > tbody tr.thwcfe_rule_row").each(function(){rule=[],$(this).find("table.thwcfe_rule > tbody tr.thwcfe_condition_set_row").each(function(){conditions=[],$(this).find("table.thwcfe_condition_set > tbody tr.thwcfe_condition").each(function(){if(condition={},ajaxFlag){var cvalue=$(this).find("input[name=i_rule_value]").val();condition.operand_type=$(this).find("input[name=i_rule_operand_type]").val(),condition.value=cvalue?cvalue.trim():cvalue}else condition.operand_type=$(this).find("select[name=i_rule_operand_type]").val();condition.operator=$(this).find("select[name=i_rule_operator]").val(),"product_variation"==condition.operand_type||"shipping_class"==condition.operand_type||"yes"==wcfe_var.input_operand?condition.operand=$(this).find("input[name=i_rule_operand]").val():condition.operand=$(this).find("select[name=i_rule_operand]").val(),is_condition_with_no_operand_type(condition.operator)&&(condition.operand_type="","user_role_eq"!=condition.operator&&"user_role_ne"!=condition.operator&&(condition.operand=$(this).find("input[name=i_rule_operand]").val())),is_valid_condition(condition)&&conditions.push(condition)}),conditions.length>0&&rule.push(conditions)}),rule.length>0&&ruleSet.push(rule)}),ruleSet.length>0&&conditionalRules.push(ruleSet)});var conditionalRulesJson=conditionalRules.length>0?JSON.stringify(conditionalRules):"";return conditionalRulesJson=encodeURIComponent(conditionalRulesJson)}function populate_conditional_rules(form,conditionalRulesJson,ajaxFlag){var conditionalRulesHtml="";if(conditionalRulesJson)try{conditionalRulesJson=decodeURIComponent(conditionalRulesJson);var conditionalRules=$.parseJSON(conditionalRulesJson);conditionalRules&&jQuery.each(conditionalRules,function(){var ruleSet=this,rulesHtml="";jQuery.each(ruleSet,function(){var rule=this,conditionSetsHtml="",y=0;rule.length;jQuery.each(rule,function(){var conditions=this,conditionsHtml="",x=1,size=conditions.length;jQuery.each(conditions,function(){var lastRow=x==size,conditionHtml=populate_condition_html(this,lastRow,ajaxFlag);conditionHtml&&(conditionsHtml+=conditionHtml),x++});var firstRule=0==y,conditionSetHtml=populate_condition_set_html(conditionsHtml,firstRule);conditionSetHtml&&(conditionSetsHtml+=conditionSetHtml),y++});var ruleHtml=populate_rule_html(conditionSetsHtml);ruleHtml&&(rulesHtml+=ruleHtml)});var ruleSetHtml=populate_rule_set_html(rulesHtml);ruleSetHtml&&(conditionalRulesHtml+=ruleSetHtml)})}catch(err){alert(err)}var conditionalRulesTable;conditionalRulesTable=ajaxFlag?form.find(".thwcfe_conditional_rules_ajax > tbody"):form.find(".thwcfe_conditional_rules > tbody"),conditionalRulesHtml?(conditionalRulesTable.html(conditionalRulesHtml),thwcfe_base.setupEnhancedMultiSelect(conditionalRulesTable),ajaxFlag||(thwcfe_base.setupProductDropdown(conditionalRulesTable,!0),thwcfe_base.setupProductTypeDropdown(conditionalRulesTable,!0)),conditionalRulesTable.find("tr.thwcfe_condition").each(function(){var operantVal=$(this).find("input[name=i_rule_operand_hidden]").val();operantVal=operantVal.split(","),$(this).find("select[name=i_rule_operand]").val(operantVal).trigger("change")}),conditionalRulesTable.find("select[name=i_rule_operator]").each(function(){ruleOperatorChangeAction($(this),!0)})):(ajaxFlag?conditionalRulesTable.html(RULE_SET_HTML_AJAX):conditionalRulesTable.html(RULE_SET_HTML),thwcfe_base.setupEnhancedMultiSelect(conditionalRulesTable),ajaxFlag||(thwcfe_base.setupProductDropdown(conditionalRulesTable,!1),thwcfe_base.setupProductTypeDropdown(conditionalRulesTable,!1)))}function populate_rule_set_html(ruleHtml){var html="";return ruleHtml&&(html+='<tr class="thwcfe_rule_set_row"><td><table class="thwcfe_rule_set" width="100%"><tbody>',html+=ruleHtml,html+="</tbody></table></td></tr>"),html}function populate_rule_html(conditionSetHtml){var html="";return conditionSetHtml&&(html+='<tr class="thwcfe_rule_row"><td><table class="thwcfe_rule" width="100%" style=""><tbody>',html+=conditionSetHtml,html+="</tbody></table></td></tr>"),html}function populate_condition_set_html(conditionsHtml,firstRule){var html="";return conditionsHtml&&(firstRule?(html+='<tr class="thwcfe_condition_set_row"><td><table class="thwcfe_condition_set" width="100%" style=""><tbody>',html+=conditionsHtml,html+="</tbody></table></td></tr>"):(html+='<tr class="thwcfe_condition_set_row"><td><table class="thwcfe_condition_set" width="100%" style=""><thead>'+OP_OR_HTML+"</thead><tbody>",html+=conditionsHtml,html+="</tbody></table></td></tr>")),html}function populate_condition_html(condition,lastRow,ajaxFlag){var html="";if(condition)if(ajaxFlag){var actionsHtml=lastRow?OP_HTML_AJAX:OP_AND_HTML_AJAX;html+='<tr class="thwcfe_condition">',html+='<td class="operand">'+prepareRuleOperandSetAjax(condition.operand)+"</td>",html+='<td class="operator">'+prepareRuleOperatorSetAjax(condition.operator)+"</td>",html+='<td class="value">'+prepareRuleValueSetAjax(condition.value)+"</td>",html+='<td class="actions">'+actionsHtml+"</td></tr>"}else{var actionsHtml=lastRow?OP_HTML:OP_AND_HTML,opType=condition.operand_type?condition.operand_type:"",operand=condition.operand?condition.operand:"",operator=condition.operator?condition.operator:"";html+='<tr class="thwcfe_condition">',html+='<td class="operator">'+prepareRuleOperatorSet(operator)+"</td>",html+='<td class="operand-type">'+prepareRuleOperandTypeSet(opType)+"</td>",html+='<td class="operand thpladmin_rule_operand">'+prepareRuleOperandSet(opType,operand,operator)+"</td>",html+='<td class="actions">'+actionsHtml+"</td></tr>"}return html}function ruleOperatorChangeAction(elm,ignoreUserRole){var operator=$(elm).val(),condition_row=$(elm).closest("tr.thwcfe_condition"),operandType=condition_row.find("select[name=i_rule_operand_type]");condition_row.find("input[name=i_rule_value]");if("user_role_eq"===operator||"user_role_ne"===operator)if(ignoreUserRole)operandType.val(""),operandType.prop("disabled",!0);else{operandType.val(""),operandType.change(),operandType.prop("disabled",!0);var target=condition_row.find("td.thpladmin_rule_operand");target.html($("#thwcfe_user_role_select").html()),thwcfe_base.setupEnhancedMultiSelect(condition_row)}else is_condition_with_no_operand_type(operator)?(operandType.val(""),operandType.change(),operandType.prop("disabled",!0)):operandType.prop("disabled",!1)}function ruleOperatorChangeListner(elm){ruleOperatorChangeAction(elm,!1)}function prepareRuleOperatorSetAjax(value){var html='<select name="i_rule_operator" value="'+value+'" onchange="thwcfeRuleOperatorChangeListnerAjax(this)" >';html+='<option value="">Select an operator...</option>';for(var index in RULE_OPERATOR_SET_AJAX){html+='<option value="'+index+'" '+(index===value?"selected":"")+">"+RULE_OPERATOR_SET_AJAX[index]+"</option>"}return html+="</select>"}function prepareRuleOperandSetAjax(value){var html='<input type="hidden" name="i_rule_operand_type" value="field"/>';return html+='<input type="hidden" name="i_rule_operand_hidden" value="'+value+'"/>',html+=$("#thwcfe_checkout_fields_select").html()}function prepareRuleValueSetAjax(value){return'<input type="text" name="i_rule_value" value="'+value+'" />'}function isValidConditionAjax(condition){return!(!condition.operand_type||!condition.operator)}function add_new_rule_row_ajax(elm,op){var condition_row=$(elm).closest("tr"),condition={};if(condition.operand_type=condition_row.find("input[name=i_rule_operand_type]").val(),condition.operator=condition_row.find("select[name=i_rule_operator]").val(),condition.operand=condition_row.find("select[name=i_rule_operand]").val(),condition.value=condition_row.find("input[name=i_rule_value]").val(),!isValidConditionAjax(condition))return void alert("Please provide a valid condition.");if(1==op){var conditionSetTable=$(elm).closest(".thwcfe_condition_set");conditionSetTable.find("tbody tr.thwcfe_condition").size()>0?($(elm).closest("td").html(OP_AND_HTML_AJAX),conditionSetTable.find("tbody tr.thwcfe_condition:last").after(CONDITION_HTML_AJAX)):conditionSetTable.find("tbody").append(CONDITION_HTML_AJAX),thwcfe_base.setupEnhancedMultiSelect(conditionSetTable)}else if(2==op){var ruleTable=$(elm).closest(".thwcfe_rule"),ruleSize=ruleTable.find("tbody tr.thwcfe_condition_set_row").size();ruleSize>0?ruleTable.find("tbody tr.thwcfe_condition_set_row:last").after(CONDITION_SET_HTML_WITH_OR_AJAX):ruleTable.find("tbody").append(CONDITION_SET_HTML_AJAX),thwcfe_base.setupEnhancedMultiSelect(ruleTable)}}function remove_rule_row_ajax(elm){var ctable=$(elm).closest("table.thwcfe_condition_set"),rtable=$(elm).closest("table.thwcfe_rule");$(elm).closest("tr.thwcfe_condition").remove();var cSize=ctable.find("tbody tr.thwcfe_condition").size();0==cSize?ctable.closest("tr.thwcfe_condition_set_row").remove():ctable.find("tbody tr.thwcfe_condition:last").find("td.actions").html(OP_HTML_AJAX);var rSize=rtable.find("tbody tr.thwcfe_condition_set_row").size();0==cSize&&0==rSize&&rtable.find("tbody").append(CONDITION_SET_HTML_AJAX),thwcfe_base.setupEnhancedMultiSelect(rtable)}function rule_operator_change_listner_ajax(elm){var operator=$(elm).val(),condition_row=$(elm).closest("tr.thwcfe_condition"),ruleValuElm=condition_row.find("input[name=i_rule_value]");"empty"===operator||"not_empty"===operator||"checked"===operator||"not_checked"===operator?(ruleValuElm.val(""),ruleValuElm.prop("readonly",!0)):ruleValuElm.prop("readonly",!1)}var RULE_OPERATOR_SET={cart_contains:"Cart contains",cart_not_contains:"Cart not contains",cart_only_contains:"Cart only contains",cart_subtotal_eq:"Cart subtotal equals to",cart_subtotal_gt:"Cart subtotal greater than",cart_subtotal_lt:"Cart subtotal less than",cart_total_eq:"Cart total equals to",cart_total_gt:"Cart total greater than",cart_total_lt:"Cart total less than",
shipping_weight_eq:"Shipping weight equals to",shipping_weight_gt:"Shipping weight greater than",shipping_weight_lt:"Shipping weight less than",user_role_eq:"User role equals to",user_role_ne:"User role not equals to"},RULE_OPERATOR_SET_NO_TYPE=["cart_subtotal_eq","cart_subtotal_gt","cart_subtotal_lt","cart_total_eq","cart_total_gt","cart_total_lt","user_role_eq","user_role_ne","shipping_weight_eq","shipping_weight_gt","shipping_weight_lt"],RULE_OPERAND_TYPE_SET={product:"Product",category:"Category",tag:"Tag",shipping_class:"Shipping Class",product_type:"Product Type"},OP_AND_HTML='<label class="thpl_logic_label">AND</label>';OP_AND_HTML+='<a href="javascript:void(0)" onclick="thwcfeRemoveRuleRow(this)" class="thpl_delete_icon dashicons dashicons-no" title="Remove"></a>';var OP_OR_HTML='<tr class="thpl_logic_label_or"><td colspan="4" align="center">OR</td></tr>',OP_HTML='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwcfeAddNewConditionRow(this, 1)" title="">AND</a>';OP_HTML+='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwcfeAddNewConditionRow(this, 2)" title="">OR</a>',OP_HTML+='<a href="javascript:void(0)" class="thpl_delete_icon dashicons dashicons-no" onclick="thwcfeRemoveRuleRow(this)" title="Remove"></a>';var CONDITION_HTML="",CONDITION_SET_HTML="",CONDITION_SET_HTML_WITH_OR="",RULE_HTML="",RULE_SET_HTML="";$(function(){CONDITION_HTML='<tr class="thwcfe_condition">',CONDITION_HTML+='<td class="operator">'+prepareRuleOperatorSet("")+"</td>",CONDITION_HTML+='<td class="operand-type">'+prepareRuleOperandTypeSet("")+"</td>",CONDITION_HTML+='<td class="operand thpladmin_rule_operand"><input type="text" name="i_rule_operand" /></td>',CONDITION_HTML+='<td class="actions">'+OP_HTML+"</td></tr>",CONDITION_SET_HTML='<tr class="thwcfe_condition_set_row"><td>',CONDITION_SET_HTML+='<table class="thwcfe_condition_set" width="100%" style=""><tbody>'+CONDITION_HTML+"</tbody></table>",CONDITION_SET_HTML+="</td></tr>",CONDITION_SET_HTML_WITH_OR='<tr class="thwcfe_condition_set_row"><td>',CONDITION_SET_HTML_WITH_OR+='<table class="thwcfe_condition_set" width="100%" style=""><thead>'+OP_OR_HTML+"</thead><tbody>"+CONDITION_HTML+"</tbody></table>",CONDITION_SET_HTML_WITH_OR+="</td></tr>",RULE_HTML='<tr class="thwcfe_rule_row"><td>',RULE_HTML+='<table class="thwcfe_rule" width="100%" style=""><tbody>'+CONDITION_SET_HTML+"</tbody></table>",RULE_HTML+="</td></tr>",RULE_SET_HTML='<tr class="thwcfe_rule_set_row"><td>',RULE_SET_HTML+='<table class="thwcfe_rule_set" width="100%"><tbody>'+RULE_HTML+"</tbody></table>",RULE_SET_HTML+="</td></tr>"});var RULE_OPERATOR_SET_AJAX={empty:"Is empty",not_empty:"Is not empty",value_eq:"Value equals to",value_ne:"Value not equals to",value_in:"Value in",value_cn:"Contains",value_nc:"Not contains",value_gt:"Value greater than",value_le:"Value less than",value_sw:"Value starts with",value_nsw:"Value not starts with",date_eq:"Date equals to",date_ne:"Date not equals to",date_gt:"Date after",date_lt:"Date before",day_eq:"Day equals to",day_ne:"Day not equals to",checked:"Is checked",not_checked:"Is not checked",regex:"Match expression"},OP_AND_HTML_AJAX='<label class="thpl_logic_label">AND</label>';OP_AND_HTML_AJAX+='<a href="javascript:void(0)" onclick="thwcfeRemoveRuleRowAjax(this)" class="thpl_delete_icon dashicons dashicons-no" title="Remove"></a>';var OP_HTML_AJAX='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwcfeAddNewConditionRowAjax(this, 1)" title="">AND</a>';OP_HTML_AJAX+='<a href="javascript:void(0)" class="thpl_logic_link" onclick="thwcfeAddNewConditionRowAjax(this, 2)" title="">OR</a>',OP_HTML_AJAX+='<a href="javascript:void(0)" class="thpl_delete_icon dashicons dashicons-no" onclick="thwcfeRemoveRuleRowAjax(this)" title="Remove"></a>';var CONDITION_HTML_AJAX="",CONDITION_SET_HTML_AJAX="",CONDITION_SET_HTML_WITH_OR_AJAX="",RULE_HTML_AJAX="",RULE_SET_HTML_AJAX="";return $(function(){CONDITION_HTML_AJAX='<tr class="thwcfe_condition">',CONDITION_HTML_AJAX+='<td class="operand">'+prepareRuleOperandSetAjax("")+"</td>",CONDITION_HTML_AJAX+='<td class="operator">'+prepareRuleOperatorSetAjax("")+"</td>",CONDITION_HTML_AJAX+='<td class="value"><input type="text" name="i_rule_value" /></td>',CONDITION_HTML_AJAX+='<td class="actions">'+OP_HTML_AJAX+"</td></tr>",CONDITION_SET_HTML_AJAX='<tr class="thwcfe_condition_set_row"><td>',CONDITION_SET_HTML_AJAX+='<table class="thwcfe_condition_set" width="100%" style=""><tbody>'+CONDITION_HTML_AJAX+"</tbody></table>",CONDITION_SET_HTML_AJAX+="</td></tr>",CONDITION_SET_HTML_WITH_OR_AJAX='<tr class="thwcfe_condition_set_row"><td>',CONDITION_SET_HTML_WITH_OR_AJAX+='<table class="thwcfe_condition_set" width="100%" style=""><thead>'+OP_OR_HTML+"</thead><tbody>"+CONDITION_HTML_AJAX+"</tbody></table>",CONDITION_SET_HTML_WITH_OR_AJAX+="</td></tr>",RULE_HTML_AJAX='<tr class="thwcfe_rule_row"><td>',RULE_HTML_AJAX+='<table class="thwcfe_rule" width="100%" style=""><tbody>'+CONDITION_SET_HTML_AJAX+"</tbody></table>",RULE_HTML_AJAX+="</td></tr>",RULE_SET_HTML_AJAX='<tr class="thwcfe_rule_set_row"><td>',RULE_SET_HTML_AJAX+='<table class="thwcfe_rule_set" width="100%"><tbody>'+RULE_HTML_AJAX+"</tbody></table>",RULE_SET_HTML_AJAX+="</td></tr>"}),{populate_conditional_rules:populate_conditional_rules,ruleOperandTypeChangeListner:rule_operand_type_change_listner,ruleOperatorChangeListner:ruleOperatorChangeListner,ruleOperatorChangeListnerAjax:rule_operator_change_listner_ajax,addNewRuleRow:add_new_rule_row,removeRuleRow:remove_rule_row,addNewRuleRowAjax:add_new_rule_row_ajax,removeRuleRowAjax:remove_rule_row_ajax,getConditionalRules:get_conditional_rules}}(window.jQuery,window,document),thwcfe_settings_field=function($,window,document){"use strict";function open_new_field_form(sname){open_field_form("new",!1)}function open_edit_field_form(elm,rowId){open_field_form("edit",elm)}function open_copy_field_form(elm,rowId){open_field_form("copy",elm)}function open_field_form(type,elm){var popup=$("#thwcfe_field_form_pp"),form=$("#thwcfe_field_form");populate_field_form(popup,form,type,elm),thwcfe_base.form_wizard_open(popup),thwcfe_base.setup_color_pick_preview(form)}function populate_field_form(popup,form,action,elm){var title="edit"===action?"Edit Field":"New Field";if(popup.find(".wizard-title").text(title),form.find(".err_msgs").html(""),form.find("input[name=f_action]").val(action),"new"===action)clear_field_form_general(form),clear_field_form_display(form),clear_field_form_price(form),clear_field_form_display_rules(form),clear_field_form_repeat_rules(form),clear_options_general_form_fields(form),form.find("select[name=i_type]").change();else{var row=$(elm).closest("tr"),props_json=row.find(".f_props").val(),props=JSON.parse(props_json);populate_field_form_general(action,form,props),form.find("select[name=i_type]").change(),populate_field_form_props(form,row,props)}}function clear_field_form_general(form){thwcfe_base.set_property_field_value(form,"hidden","name_old","",0),thwcfe_base.set_property_field_value(form,"text","name","",0),form.find("select[name=i_type]").prop("selectedIndex",0),form.find("select[name=i_type]").change(),thwcfe_base.set_property_field_value(form,"hidden","order","",0),thwcfe_base.set_property_field_value(form,"hidden","priority","",0)}function clear_field_form_display(form){thwcfe_base.set_property_field_value(form,"text","cssclass","form-row-wide",0),thwcfe_base.set_property_field_value(form,"text","input_class","",0),thwcfe_base.set_property_field_value(form,"text","title_class","",0),thwcfe_base.set_property_field_value(form,"checkbox","show_in_email",1,0),thwcfe_base.set_property_field_value(form,"checkbox","show_in_email_customer",1,0),thwcfe_base.set_property_field_value(form,"checkbox","show_in_order",1,0),thwcfe_base.set_property_field_value(form,"checkbox","show_in_thank_you_page",1,0)}function clear_field_form_price(form){form.find("select[name=i_price_type]").prop("selectedIndex",0),form.find("select[name=i_price_type]").change(),thwcfe_base.set_property_field_value(form,"text","price","",0),thwcfe_base.set_property_field_value(form,"text","price_unit","",0),form.find("select[name=i_taxable]").prop("selectedIndex",0),form.find("select[name=i_tax_class]").prop("selectedIndex",0)}function clear_options_general_form_fields(form){var count=0;$(form.find("table.thwcfe_field_form_tab_general_field_options table.thwcfe-option-list  tr")).each(function(){count>0&&$(this).remove(),count+=1}),$('[name="i_options_key[]"]').val(""),$('[name="i_options_text[]"]').val(""),$('[name="i_options_price[]"]').val(""),form.find("select[name=i_options_price_type]").prop("selectedIndex",0),form.find("select[name=i_options_price_type]").val(""),form.find("select[name=i_options_price_type]").trigger("change")}function clear_field_form_display_rules(form){var count=0;$(form.find("table.thwcfe-display-rules table.thwcfe_conditional_rules table.thwcfe_rule_set tr.thwcfe_condition")).each(function(){count>0&&$(this).remove(),count+=1});var count=0;$(form.find("table.thwcfe-display-rules table.thwcfe_conditional_rules_ajax table.thwcfe_rule_set tr.thwcfe_condition")).each(function(){count>0&&$(this).remove(),count+=1}),form.find("select[name=i_rules_action]").prop("selectedIndex",0),form.find("select[name=i_rules_action_ajax]").prop("selectedIndex",0),form.find("select[name=i_rule_operand]").prop("selectedIndex",0),form.find("select[name=i_rule_operand]").val(""),form.find("select[name=i_rule_operand]").trigger("change"),form.find("select[name=i_rule_operator]").prop("selectedIndex",0),form.find("select[name=i_rule_value]").prop("selectedIndex",0),form.find("select[name=i_rule_operand_type]").prop("selectedIndex",0),thwcfe_base.set_property_field_value(form,"text","rule_value","",0)}function clear_field_form_repeat_rules(form){form.find("select[name=i_repeat_operator]").prop("selectedIndex",0),form.find("select[name=i_repeat_operand]").prop("selectedIndex",0),form.find("select[name=i_repeat_operand]").val(""),form.find("select[name=i_repeat_operand]").trigger("change"),form.find("select[name=i_repeat_operand_type]").prop("selectedIndex",0),form.find("select[name=i_rpt_name_suffix]").prop("selectedIndex",0),form.find("select[name=i_rpt_label_suffix]").prop("selectedIndex",0),thwcfe_base.set_property_field_value(form,"text","repeat_operand","",0),thwcfe_base.set_property_field_value(form,"text","rule_operand_hidden","",0),thwcfe_base.set_property_field_value(form,"checkbox","rpt_incl_parent",0,0)}function populate_field_form_general(action,form,props){var name=props.name,type=props.type,order=props.order,priority=props.priority;"copy"===action&&(name=""),thwcfe_base.set_property_field_value(form,"text","name",name,0),thwcfe_base.set_property_field_value(form,"select","type",type,0),thwcfe_base.set_property_field_value(form,"hidden","original_type",type,0),thwcfe_base.set_property_field_value(form,"hidden","name_old",name,0),thwcfe_base.set_property_field_value(form,"hidden","order",order,0),thwcfe_base.set_property_field_value(form,"hidden","priority",priority,0),"country"==type||"state"==type||"city"==type?form.find("select[name=i_type]").prop("disabled",!0):form.find("select[name=i_type]").prop("disabled",!1)}function populate_field_form_props(form,row,props){var ftype=props.type;if($.each(FIELD_FORM_PROPS,function(name,field){if("name"==name||"type"==name)return!0;var type=field.type,value=props&&props[name]?props[name]:"";"textarea"==ftype&&"value"==name&&(type="textarea"),thwcfe_base.set_property_field_value(form,type,name,value,field.multiple),"select"==type?(name=1==field.multiple?name+"[]":name,1!=field.multiple&&1!=field.change||form.find('select[name="i_'+name+'"]').trigger("change")):"checkbox"==type&&1==field.change&&form.find('input[name="i_'+name+'"]').trigger("change")}),!props.custom){var order_meta_cb_elm=form.find('input[name="i_order_meta"]'),user_meta_cb_elm=form.find('input[name="i_user_meta"]');order_meta_cb_elm.length&&(order_meta_cb_elm.prop("checked",!0),order_meta_cb_elm.attr("readonly",!0),order_meta_cb_elm.attr("tabindex",-1)),user_meta_cb_elm.length&&("order_comments"===props.name?user_meta_cb_elm.prop("checked",!1):user_meta_cb_elm.prop("checked",!0),user_meta_cb_elm.attr("readonly",!0),user_meta_cb_elm.attr("tabindex",-1))}var optionsJson=row.find(".f_options").val();populate_options_list(form,optionsJson);var rulesAction=props&&props.rules_action?props.rules_action:"show",rulesActionAjax=props&&props.rules_action_ajax?props.rules_action_ajax:"show",conditionalRules=row.find(".f_rules").val(),conditionalRulesAjax=row.find(".f_rules_ajax").val();thwcfe_base.set_property_field_value(form,"select","rules_action",rulesAction,!1),thwcfe_base.set_property_field_value(form,"select","rules_action_ajax",rulesActionAjax,!1),thwcfe_conditions.populate_conditional_rules(form,conditionalRules,!1),thwcfe_conditions.populate_conditional_rules(form,conditionalRulesAjax,!0);var repeatRulesJson=row.find(".f_repeat_rules").val();thwcfe_repeat_rules.populate_repeat_rules(form,repeatRulesJson)}function prepare_field_form_props(form){var type=thwcfe_base.get_property_field_value(form,"select","type");prepare_price_fields(form,type),"colorpicker"==type?form.find("select[name=i_colorpicker_style]").change():"file"==type&&form.find("input[name=i_multiple_file]").change()}function prepare_price_fields(form,type){if(thwcfe_base.is_option_field(type))disable_field(form,"text","price"),disable_field(form,"select","price_type");else{var options="";-1!=$.inArray(type,["checkbox","datepicker","timepicker","file","colorpicker"])?(options+='<option value="normal">Fixed</option>',options+='<option value="percentage">Percentage of Cart Contents Total</option>',options+='<option value="percentage_subtotal">Percentage of Subtotal</option>',options+='<option value="percentage_subtotal_ex_tax">Percentage of Subtotal Ex Tax</option>'):(options+='<option value="normal">Fixed</option>',options+='<option value="custom">Custom</option>',options+='<option value="percentage">Percentage of Cart Contents Total</option>',options+='<option value="percentage_subtotal">Percentage of Subtotal</option>',options+='<option value="percentage_subtotal_ex_tax">Percentage of Subtotal Ex Tax</option>',options+='<option value="dynamic">Dynamic</option>'),form.find('select[name="i_price_type"]').html(options)}}function field_type_change_listner(elm){var popup=$("#thwcfe_field_form_pp"),form=$(elm).closest("form"),type=$(elm).val();type=null==type?"default":type,form.find(".thwcfe_field_form_tab_general_placeholder").html($("#thwcfe_field_form_id_"+type).html()),enable_all_tabs_and_fields(popup,form),-1!==$.inArray(type,FIELD_WITH_OPTIONS)?form.find(".thwcfe_field_form_tab_general_field_options").show():form.find(".thwcfe_field_form_tab_general_field_options").hide(),type in TABS_TO_HIDE&&$.each(TABS_TO_HIDE[type],function(index,tab_index){thwcfe_base.form_wizard_disable_tab(popup,tab_index)}),type in FIELDS_TO_HIDE&&$.each(FIELDS_TO_HIDE[type],function(index,name){if(FIELD_FORM_PROPS[name]){var f_props=FIELD_FORM_PROPS[name];disable_hide_field(form,f_props.type,name)}}),prepare_field_form_props(form),thwcfe_base.block_enter_key_submission(popup),thwcfe_base.setupEnhancedMultiSelect(form),thwcfe_base.setupColorPicker(form),thwcfe_base.setupSortableTable(form,".thwcfe-option-list","100")}function enable_all_tabs_and_fields(popup,form){thwcfe_base.form_wizard_enable_all_tabs(popup),form.find(":input").attr("disabled",!1),form.find("tr").removeClass("disabled hide")}function enable_disable_field(form,type,name,enabled,hide){var elm=null;switch(type){case"select":elm=form.find('select[name="i_'+name+'"]');break;case"textarea":elm=form.find("textarea[name=i_"+name+"]");break;default:elm=form.find("input[name=i_"+name+"]")}if(elm&&elm.length){var rowClass=hide?"disabled hide":"disabled";enabled?(elm.attr("disabled",!1),elm.closest("tr.form_field_"+name).removeClass("disabled hide")):(elm.attr("disabled",!0),elm.closest("tr.form_field_"+name).addClass(rowClass))}}function enable_field(form,type,name){enable_disable_field(form,type,name,!0,!1)}function disable_field(form,type,name){enable_disable_field(form,type,name,!1,!1)}function disable_hide_field(form,type,name){enable_disable_field(form,type,name,!1,!0)}function save_field(elm){var popup=$("#thwcfe_field_form_pp"),form=$("#thwcfe_field_form");if(validate_field_form(form,popup)){var is_exist=check_field_name_exist(form);-1!==is_exist.indexOf(thwcfe_current_section)&&is_exist.length>1?confirm("A field with the same name already exists in the same section and other sections ( "+is_exist.join(", ")+") as well. The field of the same section will be replaced with the new field & there are possible unexpected behaviours while creating fields with the same name in different sections. Do you wish to proceed?")&&(prepare_field_form(form),form.submit()):-1!==is_exist.indexOf(thwcfe_current_section)?confirm("A field with the same name already exist in the same section. That field will be replaced with the new field. Do you wish to proceed?")&&(prepare_field_form(form),form.submit()):is_exist.length>0?confirm("A field with the same name already exist in a different section. There are possible unexpected behaviors while creating fields with the same name in different sections. Do you wish to proceed?")&&(prepare_field_form(form),form.submit()):(prepare_field_form(form),form.submit())}}function validate_field_form(form,popup){var err_msgs="",fname=thwcfe_base.get_property_field_value(form,"text","name"),ftype=thwcfe_base.get_property_field_value(form,"select","type"),ftitle=thwcfe_base.get_property_field_value(form,"text","title"),foriginalType=thwcfe_base.get_property_field_value(form,"hidden","original_type");if(""==ftype&&-1==$.inArray(foriginalType,SPECIAL_FIELD_TYPES))err_msgs="Type is required";else if(""==fname)err_msgs="Name is required";else if(thwcfe_base.isHtmlIdValid(fname)){if("heading"==ftype||"label"==ftype)""==ftitle&&(err_msgs="Title is required");else if("paragraph"==ftype)""==ftitle&&(err_msgs="Content is required");else if("number"==ftype){var value=thwcfe_base.get_property_field_value(form,"text","value");!$.isNumeric(value)&&value&&(err_msgs="Default Value must be a number")}}else err_msgs=MSG_INVALID_NAME;return""==err_msgs||(form.find(".err_msgs").html(err_msgs),thwcfe_base.form_wizard_start(popup),!1)}function check_field_name_exist(form){var result=new Array,fname=thwcfe_base.get_property_field_value(form,"text","name"),form_action=form.find("input[name=f_action]").val();if("object"==typeof thwcfeCheckoutFields&&null!==thwcfeCheckoutFields&&$.each(thwcfeCheckoutFields,function(s_name,s_details){var sectionFields=s_details.fields;fname in sectionFields&&result.push(s_name)}),result.length>0&&"edit"==form_action){var index=result.indexOf(thwcfe_current_section);-1!==index&&result.splice(index,1)}return result}function prepare_field_form(form){var options_json=get_options(form),rules_json=thwcfe_conditions.getConditionalRules(form,!1),rules_ajax_json=thwcfe_conditions.getConditionalRules(form,!0),repeat_rules_json=thwcfe_repeat_rules.get_repeat_rules(form);thwcfe_base.set_property_field_value(form,"hidden","options",options_json,0),thwcfe_base.set_property_field_value(form,"hidden","rules",rules_json,0),thwcfe_base.set_property_field_value(form,"hidden","rules_ajax",rules_ajax_json,0),thwcfe_base.set_property_field_value(form,"hidden","repeat_rules",repeat_rules_json,0)}function get_options(form){for(var optionsKey=form.find("input[name='i_options_key[]']").map(function(){return $(this).val()}).get(),optionsText=form.find("input[name='i_options_text[]']").map(function(){return $(this).val()}).get(),optionsPrice=form.find("input[name='i_options_price[]']").map(function(){return $(this).val()}).get(),optionsPriceType=form.find("select[name='i_options_price_type[]']").map(function(){return $(this).val()}).get(),optionsSize=optionsText.length,optionsArr=[],i=0;i<optionsSize;i++){var optionDetails={};optionDetails.key=optionsKey[i],optionDetails.text=optionsText[i],optionDetails.price=optionsPrice[i],optionDetails.price_type=optionsPriceType[i],optionsArr.push(optionDetails)}var optionsJson=optionsArr.length>0?JSON.stringify(optionsArr):"";return optionsJson=encodeURIComponent(optionsJson)}function populate_options_list(form,optionsJson){var optionsHtml="";if(optionsJson)try{optionsJson=decodeURIComponent(optionsJson);var optionsList=$.parseJSON(optionsJson);optionsList&&jQuery.each(optionsList,function(){optionsHtml+=prepare_option_row_html(this)})}catch(err){alert(err)}var optionsTable=form.find(".thwcfe-option-list tbody");optionsHtml?optionsTable.html(optionsHtml):optionsTable.html(prepare_option_row_html(null))}function prepare_option_row_html(option){var key="",text="",price="",priceType="",op1Selected="",op2Selected="",op3Selected="",op4Selected="";option&&(key=option.key?option.key:"",text=option.text?option.text:"",price=option.price?option.price:"",priceType=option.price_type?option.price_type:"","percentage"===priceType?op2Selected="selected":"percentage_subtotal"===priceType?op3Selected="selected":"percentage_subtotal_ex_tax"===priceType?op4Selected="selected":op1Selected="selected");var html="<tr>";return html+='<td class="key"><input type="text" name="i_options_key[]" value="'+key+'" placeholder="Option Value"></td>',html+='<td class="value"><input type="text" name="i_options_text[]" value="'+text+'" placeholder="Option Text"></td>',html+='<td class="price"><input type="text" name="i_options_price[]" value="'+price+'" placeholder="Price"></td>',html+='<td class="price-type"><select name="i_options_price_type[]" value="'+priceType+'">',html+='<option value="" '+op1Selected+">Fixed</option>",html+='<option value="percentage" '+op2Selected+">Percentage of Cart Contents Total</option>",html+='<option value="percentage_subtotal" '+op3Selected+">Percentage of Subtotal</option>",html+='<option value="percentage_subtotal_ex_tax" '+op4Selected+">Percentage of Subtotal Ex Tax</option>",html+="</select></td>",html+='<td class="action-cell">',html+='<a href="javascript:void(0)" onclick="thwcfeAddNewOptionRow(this)" class="btn btn-tiny btn-primary" title="Add new option">+</a>',html+='<a href="javascript:void(0)" onclick="thwcfeRemoveOptionRow(this)" class="btn btn-tiny btn-danger" title="Remove option">x</a>',html+='<span class="btn btn-tiny sort ui-sortable-handle"></span></td>',html+="</tr>"}function add_new_option_row(elm){var ptable=$(elm).closest("table");ptable.find("tbody tr").size()>0?ptable.find("tbody tr:last").after(prepare_option_row_html(null)):ptable.find("tbody").append(prepare_option_row_html(null))}function remove_option_row(elm){var ptable=$(elm).closest("table");$(elm).closest("tr").remove(),0==ptable.find("tbody tr").size()&&ptable.find("tbody").append(prepare_option_row_html(null))}function price_type_change_listener(elm){var form=$(elm).closest("form"),ftype=thwcfe_base.get_property_field_value(form,"select","type");if(!thwcfe_base.is_option_field(ftype)){var priceType=$(elm).val();"dynamic"===priceType||"char-count"===priceType?(enable_field(form,"text","price"),form.find("input[name=i_price]").css("width","100px"),form.find(".thpladmin-dynamic-price-field").show(),"char-count"===priceType?form.find(".thpladmin-price-unit-label").html("Character"):form.find(".thpladmin-price-unit-label").html("Unit")):("custom"===priceType?(form.find("input[name=i_price]").val(""),form.find("input[name=i_price_unit]").val(""),disable_field(form,"text","price")):enable_field(form,"text","price"),form.find("input[name=i_price]").css("width",""),form.find(".thpladmin-dynamic-price-field").hide())}}var MSG_INVALID_NAME='NAME/ID must begin with a lowercase letter ([a-z]) or underscores ("_") and may be followed by any number of lowercase letters, digits ([0-9]) and underscores ("_")',SPECIAL_FIELD_TYPES=["country","state","city"],FIELD_WITH_OPTIONS=["select","radio","multiselect","checkboxgroup"],FIELDS_TO_HIDE={text:[],hidden:["input_class","title_class","cssclass"],password:[],number:[],tel:[],select:[],multiselect:[],radio:[],checkbox:[],checkboxgroup:[],datepicker:[],timepicker:[],colorpicker:[],file:["input_class","title_class"],heading:["input_class","title_class"],label:["input_class","title_class"],html:[],url:[],default:["type","maxlength"]},TABS_TO_HIDE={html:[1,2],label:[1,2],heading:[1,2],default:[4],paragraph:[1,2]},FIELD_FORM_PROPS={name:{name:"name",type:"text"},type:{name:"type",type:"select"},value:{name:"value",type:"text"},placeholder:{name:"placeholder",type:"text"},description:{name:"description",type:"text"},validate:{name:"validate",type:"select",multiple:1},cssclass:{name:"cssclass",type:"text"},input_class:{name:"input_class",type:"text"},title:{name:"title",type:"text"},title_type:{name:"title_type",type:"select"},title_color:{name:"title_color",type:"text"},title_class:{name:"title_class",type:"text"},subtitle:{name:"subtitle",type:"text"},subtitle_type:{name:"subtitle_type",type:"select"},subtitle_color:{name:"subtitle_color",type:"text"},subtitle_class:{name:"subtitle_class",type:"text"},is_price_field:{name:"is_price_field",type:"checkbox"},price:{name:"price",type:"text"},price_unit:{name:"price_unit",type:"text"},price_type:{name:"price_type",type:"select",change:1},taxable:{name:"taxable",type:"select"},tax_class:{name:"tax_class",type:"select"},order_meta:{name:"order_meta",type:"checkbox"},user_meta:{name:"user_meta",type:"checkbox"},disable_select2:{name:"disable_select2",type:"checkbox"},checked:{name:"checked",type:"checkbox"},required:{name:"required",type:"checkbox"},clear:{name:"clear",type:"checkbox"},enabled:{name:"enabled",type:"checkbox"},show_in_email:{name:"show_in_email",type:"checkbox"},show_in_email_customer:{name:"show_in_email_customer",type:"checkbox"},show_in_order:{name:"show_in_order",type:"checkbox"},show_in_thank_you_page:{name:"show_in_thank_you_page",type:"checkbox"},show_in_my_account_page:{name:"show_in_my_account_page",type:"checkbox"},minlength:{name:"minlength",type:"text"},maxlength:{name:"maxlength",type:"text"},input_mask:{name:"input_mask",type:"text"},maxsize:{name:"maxsize",type:"text"},accept:{name:"accept",type:"text"},custom_btn_file_upload:{name:"custom_btn_file_upload",type:"checkbox"},autocomplete:{name:"autocomplete",type:"text"},country_field:{name:"country_field",type:"text"},country:{name:"country",type:"text"},default_date:{name:"default_date",type:"text"},date_format:{name:"date_format",type:"text"},min_date:{name:"min_date",type:"text"},max_date:{name:"max_date",type:"text"},year_range:{name:"year_range",type:"text"},number_of_months:{name:"number_of_months",type:"text"},disabled_days:{name:"disabled_days",type:"select",multiple:1},disabled_dates:{name:"disabled_dates",type:"text"},min_time:{name:"min_time",type:"text"},max_time:{name:"max_time",type:"text"},start_time:{name:"start_time",type:"text"},time_step:{name:"time_step",type:"text"},time_format:{name:"time_format",type:"select"},linked_date:{name:"linked_date",type:"text"},disable_time_slot:{name:"disable_time_slot",type:"text"},html_default_datetime:{name:"html_default_datetime",type:"text"},min_html_datetime:{name:"min_html_datetime",type:"text"},max_html_datetime:{name:"max_html_datetime",type:"text"},html_default_date:{name:"html_default_date",type:"text"},min_html_date:{name:"min_html_date",type:"text"},max_html_date:{name:"max_html_date",type:"text"},html_default_time:{name:"html_default_time",type:"text"},min_html_time:{name:"min_html_time",type:"text"},max_html_time:{name:"max_html_time",type:"text"},html_default_month:{name:"html_default_month",type:"text"},min_html_month:{name:"min_html_month",type:"text"},max_html_month:{name:"max_html_month",type:"text"},html_default_week:{name:"html_default_week",type:"text"},min_html_week:{name:"min_html_week",type:"text"},max_html_week:{name:"max_html_week",type:"text"},rpt_incl_parent:{name:"rpt_incl_parent",type:"checkbox"},rpt_name_suffix:{name:"rpt_name_suffix",type:"select"},rpt_label_suffix:{name:"rpt_label_suffix",type:"select"},inherit_display_rule:{name:"inherit_display_rule",type:"checkbox"},inherit_display_rule_ajax:{name:"inherit_display_rule_ajax",type:"checkbox"},auto_adjust_display_rule_ajax:{name:"auto_adjust_display_rule_ajax",type:"checkbox"}};return{openNewFieldForm:open_new_field_form,openEditFieldForm:open_edit_field_form,openCopyFieldForm:open_copy_field_form,fieldTypeChangeListner:field_type_change_listner,addNewOptionRow:add_new_option_row,removeOptionRow:remove_option_row,priceTypeChangeListener:price_type_change_listener,save_field:save_field}}(window.jQuery,window,document),thwcfe_repeat_rules=function($,window,document){"use strict";function repeatOperandTypeChangeListner(elm){}function repeatOperatorChangeListner(elm){var operand_type=$(elm).val(),parent_row=$(elm).closest("tr.thwcfe_repeat_rule"),target=parent_row.find("td.thpladmin_repeat_operand"),value=parent_row.find("input[name='i_repeat_operand_hidden']").val();if("qty_product"===operand_type){var prod_select=$("#thwcfe_product_select .thwcfe-operand").clone();prod_select.attr("name","i_repeat_operand"),prod_select.removeAttr("multiple"),prod_select.children('option[value="-1"]').remove(),target.html(prod_select),target.append('<input type="hidden" name="i_rule_operand_hidden" value="" />'),thwcfe_base.setupEnhancedMultiSelect(parent_row),thwcfe_base.setupProductDropdown(parent_row,!1)}else if("qty_category"===operand_type){var cat_select=$("#thwcfe_product_cat_select .thwcfe-operand").clone();cat_select.attr("name","i_repeat_operand"),target.html(cat_select),thwcfe_base.setupEnhancedMultiSelect(parent_row)}else"qty_cart"===operand_type?target.html('<input type="text" name="i_repeat_operand" style="width:200px;" value="" disabled />'):(value=value||"",target.html('<input type="text" name="i_repeat_operand" style="width:200px;" value="'+value+'"/>'))}function get_repeat_rules(form){var operator=thwcfe_base.get_property_field_value(form,"select","repeat_operator"),operand=thwcfe_base.get_property_field_value(form,"select","repeat_operand");operand="qty_cart"===operator?-1:operand;var rule_json="";return operator&&operand&&(rule_json=operator+":"+operand),rule_json}function populate_repeat_rules(form,ruleJson){if(ruleJson)try{var repeat_rules=ruleJson.split(":");if(2==repeat_rules.length){var operator=repeat_rules[0],operand=repeat_rules[1];form.find("select[name=i_repeat_operator]").val(operator).trigger("change"),form.find("input[name=i_rule_operand_hidden]").val(operand),form.find("select[name=i_repeat_operand]").val(operand),thwcfe_base.prepare_selected_options(form.find("select[name=i_repeat_operand]"))}}catch(err){alert(err)}else form.find("select[name=i_repeat_operator]").prop("selectedIndex",0).trigger("change"),form.find("select[name=i_rpt_name_suffix]").prop("selectedIndex",0).trigger("change"),form.find("select[name=i_rpt_label_suffix]").prop("selectedIndex",0).trigger("change")}return{get_repeat_rules:get_repeat_rules,populate_repeat_rules:populate_repeat_rules,repeatOperatorChangeListner:repeatOperatorChangeListner,repeatOperandTypeChangeListner:repeatOperandTypeChangeListner}}(window.jQuery,window,document),thwcfe_settings_section=function($,window,document){"use strict";function open_new_section_form(){open_section_form("new",!1)}function open_edit_section_form(valueJson){open_section_form("edit",valueJson)}function open_copy_section_form(valueJson){open_section_form("copy",valueJson)}function open_section_form(type,valueJson){var popup=$("#thwcfe_section_form_pp"),form=$("#thwcfe_section_form");populate_section_form(popup,form,type,valueJson),thwcfe_base.form_wizard_open(popup),thwcfe_base.setupColorPicker(form),thwcfe_base.setup_color_pick_preview(form),thwcfe_base.setupEnhancedMultiSelect(form)}function populate_section_form(popup,form,type,valueJson){var title="edit"===type?"Edit Section":"New Section";if(popup.find(".wizard-title").text(title),
form.find(".err_msgs").html(""),form.find("input[name=i_name]").prop("readonly",!1),form.find("input[name=s_action]").val(type),form.find("input[name=s_name]").val(""),form.find("input[name=s_name_copy]").val(""),form.find("input[name=i_position_old]").val(""),form.find("input[name=i_rules]").val(""),form.find("input[name=i_rules_ajax]").val(""),form.find("input[name=i_repeat_rules]").val(""),"new"===type)set_form_field_values(form,SECTION_FORM_FIELDS,!1);else{if(set_form_field_values(form,SECTION_FORM_FIELDS,valueJson),"copy"===type){var sNameCopy=valueJson?valueJson.name:"";form.find("input[name=i_name]").val(""),form.find("input[name=s_name_copy]").val(sNameCopy)}else form.find("input[name=i_name]").prop("readonly",!0);form.find("select[name=i_position_old]").val(valueJson.position),setTimeout(function(){form.find("select[name=i_position]").focus()},1)}}function display_position_change_listner(elm){var position=($(elm).closest("form"),$(elm).val());-1!==$.inArray(position,ALERT_POSITION)&&alert("Please ensure that Terms and Condition is enabled on WooCommerce settings. ")}function set_form_field_values(form,fields,valuesJson){var sname=valuesJson&&valuesJson.name?valuesJson.name:"";$.each(fields,function(name,field){var type=field.type;if(valuesJson)var value=valuesJson[name]?valuesJson[name]:"";else var value=valuesJson[name]?valuesJson[name]:field.value;var multiple=field.multiple?field.multiple:0;"checkbox"===type&&!valuesJson&&field.checked&&(value=field.checked),thwcfe_base.set_property_field_value(form,type,name,value,multiple)});var prop_form=$("#section_prop_form_"+sname),rulesAction=valuesJson&&valuesJson.rules_action?valuesJson.rules_action:"show",rulesActionAjax=valuesJson&&valuesJson.rules_action_ajax?valuesJson.rules_action_ajax:"show",conditionalRules=prop_form.find(".f_rules").val(),conditionalRulesAjax=prop_form.find(".f_rules_ajax").val();thwcfe_base.set_property_field_value(form,"select","rules_action",rulesAction,!1),thwcfe_base.set_property_field_value(form,"select","rules_action_ajax",rulesActionAjax,!1),thwcfe_conditions.populate_conditional_rules(form,conditionalRules,!1),thwcfe_conditions.populate_conditional_rules(form,conditionalRulesAjax,!0);var repeatRulesJson=valuesJson&&valuesJson.repeat_rules?valuesJson.repeat_rules:"";thwcfe_repeat_rules.populate_repeat_rules(form,repeatRulesJson)}function save_section(elm){var popup=$("#thwcfe_section_form_pp"),form=$("#thwcfe_section_form");validate_section(form,popup)&&(prepare_section_form(form),form.submit())}function validate_section(form,popup){var name=form.find("input[name=i_name]").val(),title=form.find("input[name=i_title]").val(),position=form.find("select[name=i_position]").val();name=name||"",position=position||"";var err_msgs="";return""==name.trim()?err_msgs="Name/ID is required":thwcfe_base.isHtmlIdValid(name)?-1!==RESERVED_SECTION_NAMES.indexOf(name)?err_msgs="The provided Name/ID is already used for the default section. Please use a different name.":""==title.trim()?err_msgs="Title is required":""==position&&(err_msgs="Please select a position"):err_msgs=MSG_INVALID_NAME,""==err_msgs||(form.find(".err_msgs").html(err_msgs),thwcfe_base.form_wizard_start(popup),!1)}function prepare_section_form(form){var rules_json=thwcfe_conditions.getConditionalRules(form,!1),rules_ajax_json=thwcfe_conditions.getConditionalRules(form,!0),repeat_rules_json=thwcfe_repeat_rules.get_repeat_rules(form);thwcfe_base.set_property_field_value(form,"hidden","rules",rules_json,0),thwcfe_base.set_property_field_value(form,"hidden","rules_ajax",rules_ajax_json,0),thwcfe_base.set_property_field_value(form,"hidden","repeat_rules",repeat_rules_json,0)}function remove_section(elm){if(confirm("Are you sure you want to delete this section?.")){var form=$(elm).closest("form");form&&form.submit()}}var MSG_INVALID_NAME='NAME/ID must begin with a lowercase letter ([a-z]) and may be followed by any number of lowercase letters, digits ([0-9]) and underscores ("_")',SECTION_FORM_FIELDS={name:{name:"name",label:"Name/ID",type:"text",required:1},position:{name:"position",label:"Display Position",type:"select",value:"before_checkout_billing_form",required:1},order:{name:"order",label:"Display Order",type:"text"},cssclass:{name:"cssclass",label:"CSS Class",type:"text"},show_title:{name:"show_title",label:"Show section title in checkout page.",type:"checkbox",value:"yes",checked:!0},show_title_my_account:{name:"show_title_my_account",label:"Show section title in my account page.",type:"checkbox",value:"yes",checked:!0},title:{name:"title",label:"Title",type:"text"},title_type:{name:"title_type",label:"Title Type",type:"select",value:"h3"},title_color:{name:"title_color",label:"Title Color",type:"colorpicker"},title_class:{name:"title_class",label:"Title Class",type:"text"},subtitle:{name:"subtitle",label:"Subtitle",type:"text"},subtitle_type:{name:"subtitle_type",label:"Subtitle Type",type:"select",value:"p"},subtitle_color:{name:"subtitle_color",label:"Subtitle Color",type:"colorpicker"},subtitle_class:{name:"subtitle_class",label:"Subtitle Class",type:"text"},rpt_incl_parent:{name:"rpt_incl_parent",type:"checkbox"},rpt_name_suffix:{name:"rpt_name_suffix",type:"select",value:"number"},rpt_label_suffix:{name:"rpt_label_suffix",type:"select",value:"number"},inherit_display_rule:{name:"inherit_display_rule",type:"checkbox",value:"yes",checked:!0},inherit_display_rule_ajax:{name:"inherit_display_rule_ajax",type:"checkbox",value:"yes",checked:!0},auto_adjust_display_rule_ajax:{name:"auto_adjust_display_rule_ajax",type:"checkbox",value:"yes",checked:!0}},ALERT_POSITION=["after_terms_and_conditions","before_terms_and_conditions"],RESERVED_SECTION_NAMES=["billing","shipping","additional"];return{openNewSectionForm:open_new_section_form,openEditSectionForm:open_edit_section_form,openCopySectionForm:open_copy_section_form,DisplayPositionChangeListner:display_position_change_listner,save_section:save_section,remove_section:remove_section}}(window.jQuery,window,document),thwcfe_settings=function($,window,document){"use strict";function select_all_fields(elm){var checkAll=$(elm).prop("checked");$("#thwcfe_checkout_fields tbody input:checkbox[name=select_field]").prop("checked",checkAll),$("#thwcfe_checkout_fields tbody input.f_selected").val(Number(checkAll))}function remove_selected_fields(){$("#thwcfe_checkout_fields tbody tr").removeClass("strikeout"),$("#thwcfe_checkout_fields tbody input:checkbox[name=select_field]:checked").each(function(){var row=$(this).closest("tr");row.hasClass("strikeout")||row.addClass("strikeout"),row.find(".f_deleted").val(1)})}function enable_disable_selected_fields(enabled){$("#thwcfe_checkout_fields tbody input:checkbox[name=select_field]:checked").each(function(){var row=$(this).closest("tr");0==enabled?row.hasClass("thpladmin-disabled")||row.addClass("thpladmin-disabled"):row.removeClass("thpladmin-disabled"),row.find(".td_enabled").html(1==enabled?'<span class="dashicons dashicons-yes tips" data-tip="Yes"></span>':"-"),row.find(".f_enabled").val(enabled)})}function bulk_action_listner(elm){var value=$(elm).val();$("input[name=action_type]").each(function(){this.value=value})}function apply_bulk_action(elm,event){var action=$(elm).closest("tr").find("input[name=action_type]").val();if("reset_section"==action||"reset_all_sections"==action)confirm("This action cannot be undone. Are you sure you want to continue?")||event.preventDefault();else if("import_fields_section"==action){event.preventDefault();var popup=$("#thwcfe_export_form_pp");popup.css("display","block")}$("select[name=bulk_action_options]").each(function(){$(this).prop("selectedIndex",0)})}function checkout_field_selected(elm){var row=$(elm).closest("tr");$(elm).is(":checked")?row.find(".f_selected").val(1):row.find(".f_selected").val(0)}function restore_default_fields(elm,event){event.preventDefault();var nonce=$(elm).attr("data-nonce");if(confirm("Are you sure you want to reset to default fields? All the changes you made in the fields & sections will be deleted!")){var data={_wpnonce:nonce,action:"thwcfe_reset_to_default"};$.ajax({type:"POST",url:ajaxurl,data:data,beforeSend:function(){},success:function(response){location.reload(!0)},error:function(jqXHR,textStatus,errorThrown){alert("Some error happens! Try again later.")},complete:function(jqXHR,textStatus){}})}}function widgetPopUp(){var x=document.getElementById("myDIV"),th_animation=(document.getElementById("myWidget"),document.getElementById("th_quick_border_animation")),th_arrow=document.getElementById("th_arrow_head");"none"!==x.style.display&&x.style.display?(x.style.display="none",th_arrow.style="transform:rotate(45deg);",th_animation.style.animation="pulse 1.5s infinite"):(x.style.display="block",th_arrow.style="transform:rotate(-12.5deg);",th_animation.style="box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);",th_animation.style.animation="none")}function widgetClose(){var z=document.getElementById("myDIV"),th_animation=(document.getElementById("myWidget"),document.getElementById("th_quick_border_animation")),th_arrow=document.getElementById("th_arrow_head");z.style.display="none",th_arrow.style="transform:rotate(45deg);",th_animation.style.animation="pulse 1.5s infinite"}return $(function(){var settings_form=$("#thwcfe_checkout_fields_form");thwcfe_base.setupSortableTable(settings_form,"#thwcfe_checkout_fields","0"),thwcfe_base.setup_tiptip_tooltips(),thwcfe_base.setup_form_wizard()}),{thwcfewidgetPopUp:widgetPopUp,thwcfewidgetClose:widgetClose,selectAllFields:select_all_fields,removeSelectedFields:remove_selected_fields,enableDisableSelectedFields:enable_disable_selected_fields,bulkActionListner:bulk_action_listner,applyBulkAction:apply_bulk_action,checkoutFieldSelected:checkout_field_selected,restoreDefaultFields:restore_default_fields}}(window.jQuery,window,document);